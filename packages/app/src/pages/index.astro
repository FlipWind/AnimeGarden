---
import { getRuntime } from '@astrojs/cloudflare/runtime';

import Layout from '../layouts/Layout.astro';
import Pagination from '../components/Pagination.astro';
import ResourceTable from '../components/ResourceTable.astro';

import type { Env } from '../env';
import { wfetch, fetchResources } from '../fetch';

const runtime = getRuntime<Env>(Astro.request);

const { ok, resources } = await fetchResources(
  1,
  { pageSize: 80 },
  { fetch: wfetch(runtime?.env?.worker) }
);
---

<Layout title="Anime Garden">
  <div class="mt-4vh w-full">
    {
      ok ? (
        <>
          <ResourceTable resources={resources} />
          <Pagination page={1} href={(page) => `/resources/${page}`} />
        </>
      ) : (
        <>
          <div class="h-20 text-2xl text-red-700/80 flex items-center justify-center">
            <span class="mr2 i-carbon-error" />
            <span>发生错误</span>
          </div>
        </>
      )
    }
  </div>
</Layout>
